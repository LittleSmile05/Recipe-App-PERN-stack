<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200">
    <link rel="stylesheet" href="style.css">
    <style>
        .time-card input[type="radio"] {
            display: none;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <div class="calendar-container">
            <header style="background-color: #4e9bec; color: white; padding: 15px; border-radius: 10px;">
                <div class="current-date"></div>
                <div class="icons">
                    <span id="prev" class="material-symbols-rounded">chevron_left</span>
                    <span id="next" class="material-symbols-rounded">chevron_right</span>
                </div>
            </header>
            <div class="calendar">

                <ul class="weekdays">
                    <li>Sun</li>
                    <li>Mon</li>
                    <li>Tue</li>
                    <li>Wed</li>
                    <li>Thu</li>
                    <li>Fri</li>
                    <li>Sat</li>
                </ul>
                <ul class="days"></ul>
            </div>
        </div>

    </div>
    <div class="time-selection">
        <div class="tbtn">
            <div class="time-card">
                <input type="radio" id="time1" name="time" value="13:30">
                <label for="time1">13:30</label>
            </div>

            <div class="time-card">
                <input type="radio" id="time2" name="time" value="14:30">
                <label for="time2">14:30</label>
            </div>

            <div class="time-card">
                <input type="radio" id="time3" name="time" value="15:30">
                <label for="time3">15:30</label>
            </div>
        </div>
        <div id="selectedTime" style="color: rgb(60, 184, 230); margin-top: 30px; margin-bottom: 20px; "></div> <!-- Added to display the selected time -->
        <button onclick="submitTime()">Submit</button>
        <button onclick="clearLocalStorage()" style="margin-top: 20px;">Clear</button> <!-- Button to clear localStorage -->

    </div>

</body>
<script>
    // Check if there are any saved selections in localStorage
    let savedSelections = JSON.parse(localStorage.getItem('calendarSelections')) || {};

    const daysTag = document.querySelector(".days"),
        currentDate = document.querySelector(".current-date"),
        prevNextIcon = document.querySelectorAll(".icons span"),
        timeSelection = document.querySelector(".time-selection"),
        selectedTimeText = document.getElementById('selectedTime');

    let date = new Date(),
        currYear = date.getFullYear(),
        currMonth = date.getMonth(),
        selectedDay = null; // Variable to store the selected day

    const months = ["January", "February", "March", "April", "May", "June", "July",
        "August", "September", "October", "November", "December"];

    const renderCalendar = () => {
        let firstDayofMonth = new Date(currYear, currMonth, 1).getDay(),
            lastDateofMonth = new Date(currYear, currMonth + 1, 0).getDate(),
            lastDayofMonth = new Date(currYear, currMonth, lastDateofMonth).getDay(),
            lastDateofLastMonth = new Date(currYear, currMonth, 0).getDate();
        let liTag = "";

        for (let i = firstDayofMonth; i > 0; i--) {
            liTag += `<li class="inactive">${lastDateofLastMonth - i + 1}</li>`;
        }

        for (let i = 1; i <= lastDateofMonth; i++) {
            let isActive = i >= 3 && i <= 5 ? "active" : "";
            liTag += `<li class="${isActive}" onclick="handleDateSelection(${i})">${i}</li>`;
        }

        for (let i = lastDayofMonth; i < 6; i++) {
            liTag += `<li class="inactive">${i - lastDayofMonth + 1}</li>`
        }
        currentDate.innerText = `${months[currMonth]} ${currYear}`;
        daysTag.innerHTML = liTag;
    }

    const renderSavedSelections = () => {
        Object.keys(savedSelections).forEach(day => {
            const timeCard = document.getElementById(savedSelections[day]);
            if (timeCard) {
                timeCard.parentElement.style.backgroundColor = 'transparent'; 
            }
        });
    }

    renderCalendar();
    renderSavedSelections();

    prevNextIcon.forEach(icon => {
        icon.addEventListener("click", () => {
            // Remove selections for past dates when changing month
            Object.keys(savedSelections).forEach(day => {
                const [savedMonth, savedDay] = savedSelections[day].split('-').map(Number);
                if (savedMonth !== currMonth) {
                    delete savedSelections[day];
                }
            });

            currMonth = icon.id === "prev" ? currMonth - 1 : currMonth + 1;

            if (currMonth < 0 || currMonth > 11) {
                date = new Date(currYear, currMonth, new Date().getDate());
                currYear = date.getFullYear();
                currMonth = date.getMonth();
            } else {
                date = new Date();
            }
            renderCalendar();
            renderSavedSelections(); // Update saved selections after removing past dates
            updateSelectedTimeText(); // Update selected time text when month changes
        });
    });

    const handleDateSelection = (selectedDate) => {
        const savedDaySelection = savedSelections[selectedDate];

        if (selectedDate >= 3 && selectedDate <= 5) {
            timeSelection.classList.add('show');
            selectedDay = selectedDate; // Update selected day
            updateSelectedTimeText(); // Update selected time text
        }
    }

    function updateSelectedTimeText() {
        if (selectedDay !== null) {
            const savedTimeKey = savedSelections[selectedDay];
            if (savedTimeKey) {
                selectedTimeText.innerText = `Selected time for ${months[currMonth]} ${selectedDay}: ${document.getElementById(savedTimeKey).nextElementSibling.innerText}`;
            } else {
                selectedTimeText.innerText = `Selected time for ${months[currMonth]} ${selectedDay}:`;
            }
        }
    }

    function submitTime() {
        const selectedTime = document.querySelector('input[name="time"]:checked');

        if (selectedTime && selectedDay !== null) {
            const time = selectedTime.value;
            const daySelectionKey = `${currMonth}-${selectedDay}`;

            // Remove blue background from all buttons
            const timeCards = document.querySelectorAll('.time-card');
            timeCards.forEach(card => {
                card.parentElement.style.backgroundColor = 'transparent';
            });

            // Save selection to localStorage
            savedSelections[selectedDay] = selectedTime.id;
            localStorage.setItem('calendarSelections', JSON.stringify(savedSelections));

            selectedTimeText.innerText = `You have selected ${time} on ${months[currMonth]} ${selectedDay}`;
            timeSelection.classList.remove('show');

            // Add blue background only to the latest selected time button
            selectedTime.parentElement.style.backgroundColor = 'blue'; 
        } else {
            alert('Please select a time.');
        }
    }

    function clearLocalStorage() {
        localStorage.clear(); // Clear localStorage
        savedSelections = {}; // Clear saved selections object
        renderSavedSelections(); // Update UI to reflect cleared localStorage
        selectedTimeText.innerText = ''; // Clear the selected time text
    }
</script>
</html>
